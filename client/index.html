<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatGPT AI</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <header>
        <h1>ChatGPT AI</h1>
        <button id="clear-button">Clear</button>
      </header>
      <div id="chat_container">
        <div id="message_wrapper" style="overflow-y: auto;"></div>
      </div>
      
      <form>
        <textarea
          name="prompt"
          rows="1"
          cols="1"
          style="overflow:auto;"
          placeholder="Ask anything..."
        ></textarea>
        <button type="submit"><img src="assets/send.svg" alt="send" /></button>
      </form>
    </div>
    <script type="module" src="script.js"></script>
    <script type="module">
      import { chatStripe } from './chatStripe.js';
      const clearButton = document.getElementById('clear-button');
      const messageWrapper = document.getElementById('message_wrapper');
      const form = document.querySelector('form');
      const prompt = document.querySelector('textarea[name="prompt"]');
      
      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const input = prompt.value;
        if (!input) return;
        
        const uniqueId = Date.now().toString();
        const message = chatStripe(false, input, uniqueId);
        messageWrapper.insertAdjacentHTML('beforeend', message);
        prompt.value = '';
        
        fetch('/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: input })
        })
          .then(response => response.json())
          .then(data => {
            const message = chatStripe(true, data.response, uniqueId);
            const messageElement = document.getElementById(uniqueId);
            messageElement.innerHTML = message;
          });
      });

      clearButton.addEventListener('click', () => {
        localStorage.clear();
        messageWrapper.innerHTML = '';
        console.log('Local storage cleared!');
      });
    </script>
  </body>
</html>
